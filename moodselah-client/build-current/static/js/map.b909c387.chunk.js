(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{379:function(e,t,a){e.exports={container:"MapPlaceModal_container__1IjZ3",contentContainer:"MapPlaceModal_contentContainer__WX-TC",closeContainer:"MapPlaceModal_closeContainer__aP5Mh",btnClose:"MapPlaceModal_btnClose__12qcH"}},381:function(e,t,a){e.exports={info:"Map_info__13daX",title:"Map_title__mwyY4",btnContainer:"Map_btnContainer__2jQ7p",btnLink:"Map_btnLink__W2ZXR",photos:"Map_photos__3KYHH"}},383:function(e,t,a){"use strict";var n,o,r,s=a(132),i=a(366),c=a.n(i),l=a(367),p=a(47),d=a(48),u=a(50),m=a(49),h=a(51),g=a(101),f=a(0),v=a(388),C=a(102),k=a(370),b=a.n(k),y=a(30),M=a.n(y),L=a(376),O=a.n(L),_=a(379),w=a.n(_),j=f.memo(function(e){return f.createElement(O.a,{open:e.isVisible,onClose:e.onClose},f.createElement("div",{className:w.a.container},f.createElement("div",{className:w.a.closeContainer},f.createElement("button",{className:w.a.btnClose,type:"button",onClick:e.onClose},"x")),f.createElement("div",{className:w.a.contentContainer},e.children)))}),P=a(381),E=a.n(P),R={dots:!0,infinite:!1,speed:500,autoplay:!1,slidesToShow:4,slidesToScroll:4,prevArrow:f.createElement(function(e){var t=e.className,a=e.style,n=e.onClick;return f.createElement("div",{className:t,style:Object(s.a)({},a,{left:"16px",zIndex:10,display:-1!==t.indexOf("disable")?"none":"block"}),onClick:n})},null),nextArrow:f.createElement(function(e){var t=e.className,a=e.style,n=e.onClick;return f.createElement("div",{className:t,style:Object(s.a)({},a,{right:"16px",zIndex:10,display:-1!==t.indexOf("disable")?"none":"block"}),onClick:n})},null)},x=f.memo(function(e){return f.createElement(f.Fragment,null,f.createElement("div",{ref:e.mapRef,className:M()(e.className)}),f.createElement(j,{onClose:e.onCloseMapPlaceModal,isVisible:e.isVisiblePlaceInfo},e.place?f.createElement("div",{className:E.a.info},f.createElement("h2",{className:E.a.title},e.place.address),f.createElement("div",{className:E.a.btnContainer},f.createElement("a",{className:E.a.btnLink,href:"http://map.daum.net/link/map/".concat(e.place.address,",").concat(e.place.lat,",").concat(e.place.lng),target:"_blank"},"\ud070\uc9c0\ub3c4\ubcf4\uae30"),f.createElement("a",{className:E.a.btnLink,href:"http://map.daum.net/link/to/".concat(e.place.address,",").concat(e.place.lat,",").concat(e.place.lng),target:"_blank"},"\uae38\ucc3e\uae30")),f.createElement("div",{className:E.a.photos},f.createElement(b.a,R,e.place.photos.map(function(e){return f.createElement("a",{key:e.path,href:"/posts/".concat(e.postId)},f.createElement("img",{src:e.path}))})))):null))}),N=(r=o=function(e){function t(){var e,a;Object(p.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).mapRef=f.createRef(),a.map=void 0,a.marker=void 0,a.geocoder=void 0,a.clusterer=void 0,a.state={place:null,isVisiblePlaceInfo:!1},a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=Object(l.a)(c.a.mark(function e(){var t,a=this;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:"kakao_map",!!document.getElementById("kakao_map")?this.onInit():((t=document.createElement("script")).src="//dapi.kakao.com/v2/maps/sdk.js?appkey=128a2da1935ecfc8ce068ce4e4fe0d7d&libraries=services,clusterer,drawing&autoload=false",t.onload=function(){return daum.maps.load(function(){return a.onInit()})},t.id="kakao_map",document.body.appendChild(t));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(e){this.setMinMax(),this.updateData(e),this.updateCenter(e),this.updateMarkerFromDetailAddr(e)}},{key:"onInit",value:function(){var e=Object(l.a)(c.a.mark(function e(){var t,a,n,o,r,s,i,l,p,d;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getCurrentLocation();case 3:t=e.sent,e.next=8;break;case 6:e.prev=6,e.t0=e.catch(0);case 8:this.props.initialOption&&(n=this.props.initialOption,o=n.center,r=n.level,o&&(t=o),r&&(a=r)),i=(s=t||{lat:37.566826,lng:126.9786567}).lat,l=s.lng,this.map=new daum.maps.Map(this.mapRef.current,{center:new daum.maps.LatLng(i,l),level:a}),this.geocoder=new daum.maps.services.Geocoder,this.props.readOnly||this.props.data&&this.props.data.length||(this.marker=new daum.maps.Marker,this.marker.setMap(this.map)),p=new daum.maps.MapTypeControl,this.map.addControl(p,daum.maps.ControlPosition.TOPRIGHT),d=new daum.maps.ZoomControl,this.map.addControl(d,daum.maps.ControlPosition.RIGHT),this.map.setZoomable(!1),this.registerMarkers(),this.registerSubscribes();case 20:case"end":return e.stop()}},e,this,[[0,6]])}));return function(){return e.apply(this,arguments)}}()},{key:"registerMarkers",value:function(){var e=this;if(this.props.data){this.clusterer?this.clusterer.clear():this.clusterer=new daum.maps.MarkerClusterer({map:this.map,averageCenter:!0,minLevel:10});var t=this.props.data.map(function(t){var a=new daum.maps.LatLng(t.lat,t.lng),n=new daum.maps.Marker({position:a}),o=(t.posts||[]).flatMap(function(e){return e.photos.map(function(t){return Object(s.a)({},t,{postId:e.id})})});return daum.maps.event.addListener(n,"click",function(){e.setState({isVisiblePlaceInfo:!0,place:Object(s.a)({},t,{photos:o})})}),n});this.clusterer.addMarkers(t)}}},{key:"registerSubscribes",value:function(){var e=this;this.setMinMax(),this.props.onMapReady&&this.props.onMapReady(this.region),daum.maps.event.addListener(this.map,"bounds_changed",function(){e.props.onChangeRegion&&e.props.onChangeRegion(e.region)}),daum.maps.event.addListener(this.map,"idle",function(){e.props.onChangeRegionComplete&&e.props.onChangeRegionComplete(e.region)}),daum.maps.event.addListener(this.map,"click",function(t){e.marker&&e.searchDetailAddrFromCoords(t.latLng,function(a,n){if(n===daum.maps.services.Status.OK){var o=a[0].road_address?a[0].road_address.address_name:"",r=a[0].address.address_name;e.marker.setPosition(t.latLng),e.marker.setMap(e.map),e.props.onChangeMarkerPosition&&e.props.onChangeMarkerPosition({roadAddr:o,jibunAddr:r,lat:t.latLng.getLat(),lng:t.latLng.getLng()})}})}),this.props.address&&this.searchCoordFromDetailAddr(this.props.address)}},{key:"getCurrentLocation",value:function(){return new Promise(function(e,t){"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(t){e({lat:t.coords.latitude,lng:t.coords.longitude})},function(e){t(e)}):t(new Error("not supported geolocation."))})}},{key:"updateData",value:function(e){e.data!==this.props.data&&this.registerMarkers()}},{key:"updateCenter",value:function(e){var t=this.props.center;t&&!Object(v.a)(e.center,t)&&this.map.setCenter(new daum.maps.LatLng(t.lat,t.lng))}},{key:"updateMarkerFromDetailAddr",value:function(e){e.address!==this.props.address&&this.searchCoordFromDetailAddr(this.props.address)}},{key:"setMinMax",value:function(){this.map&&(this.props.maxZoomLevel&&this.map.setMinLevel(this.props.maxZoomLevel),this.props.minZoomLevel&&this.map.setMaxLevel(this.props.minZoomLevel))}},{key:"searchDetailAddrFromCoords",value:function(e,t){this.geocoder.coord2Address(e.getLng(),e.getLat(),t)}},{key:"searchCoordFromDetailAddr",value:function(e){var t=this;this.geocoder.addressSearch(e,function(e,a){if(a===daum.maps.services.Status.OK){var n=new daum.maps.LatLng(e[0].y,e[0].x);t.searchDetailAddrFromCoords(n,function(e,a){if(a===daum.maps.services.Status.OK){var o=e[0].road_address?e[0].road_address.address_name:"",r=e[0].address.address_name;t.marker.setPosition(n),t.map.setCenter(n),t.props.onChangeMarkerPosition&&t.props.onChangeMarkerPosition({roadAddr:o,jibunAddr:r,lat:n.getLat(),lng:n.getLng()})}})}})}},{key:"onCloseMapPlaceModal",value:function(){this.setState({isVisiblePlaceInfo:!1})}},{key:"render",value:function(){return f.createElement(x,Object.assign({},this.props,this.state,{mapRef:this.mapRef,onCloseMapPlaceModal:this.onCloseMapPlaceModal}))}},{key:"region",get:function(){return{bounds:t.matchBoundsKey(this.map.getBounds()),zoomLevel:this.map.getLevel(),center:t.mathCenterKey(this.map.getCenter())}}}],[{key:"matchBoundsKey",value:function(e){var t=e.getSouthWest(),a=e.getNorthEast();return{n:a.getLat(),e:a.getLng(),s:t.getLat(),w:t.getLng()}}},{key:"mathCenterKey",value:function(e){return{lat:e.getLat(),lng:e.getLng()}}}]),t}(f.PureComponent),o.defaultProps={onMapReady:function(){},onChangeRegion:function(){},onChangeRegionComplete:function(){},onChangeMarkerPosition:function(){},data:[],readOnly:!1},n=r,Object(g.a)(n.prototype,"onCloseMapPlaceModal",[C.a],Object.getOwnPropertyDescriptor(n.prototype,"onCloseMapPlaceModal"),n.prototype),n);t.a=N},552:function(e,t,a){e.exports={container:"Map_container__1I5H5",map:"Map_map__QCdvM"}},579:function(e,t,a){"use strict";a.r(t);var n=a(366),o=a.n(n),r=a(367),s=a(48),i=a(101),c=a(47),l=a(50),p=a(49),d=a(51),u=a(0),m=a(52),h=a(102),g=a(64),f=a(65);function v(){var e=Object(g.a)(["\n  query getPlaces($lat: Float!, $lng: Float!, $where: String) {\n    GetPlaces(lat: $lat, lng: $lng, where: $where) {\n      success\n      error\n      places {\n        id\n        address\n        lat\n        lng\n        posts {\n          id\n          content\n          photos {\n            id\n            path\n          }\n        }\n      }\n    }\n  }\n"]);return v=function(){return e},e}var C,k=Object(f.a)(v()),b=a(369),y=a.n(b),M=a(383),L=a(77),O=a(552),_=a.n(O),w=Object(L.a)(function(e){if(e.loading)return null;var t=(e.data||{}).GetPlaces,a=(t=void 0===t?{}:t).places,n=void 0===a?null:a;return n?u.createElement(u.Fragment,null,u.createElement(y.a,null,u.createElement("title",null,e.t("map.title")," - Moodselah")),u.createElement("div",{className:_.a.container},u.createElement(M.a,{className:_.a.map,initialOption:{level:5},data:n,readOnly:!0,onChangeRegionComplete:e.onChangeRegionComplete}))):null}),j=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),t}(m.Query),P=(C=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).fetchMore=void 0,a.state={isInfiniteScroll:!1,isFinishedLoadMore:!1,lat:void 0,lng:void 0},a}return Object(d.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=Object(r.a)(o.a.mark(function e(){var t,a,n,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getCurrentLocation();case 3:t=e.sent,e.next=8;break;case 6:e.prev=6,e.t0=e.catch(0);case 8:n=(a=t||{lat:37.566826,lng:126.9786567}).lat,r=a.lng,this.setState({lat:n,lng:r});case 10:case"end":return e.stop()}},e,this,[[0,6]])}));return function(){return e.apply(this,arguments)}}()},{key:"onLoadMore",value:function(e,t){this.fetchMore&&this.fetchMore({variables:{lat:e,lng:t},updateQuery:function(e,t){var a=t.fetchMoreResult;return a||e}})}},{key:"onChangeRegionComplete",value:function(e){var t=e.center,a=t.lat,n=t.lng;this.onLoadMore(a,n)}},{key:"getCurrentLocation",value:function(){return new Promise(function(e,t){"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(t){e({lat:t.coords.latitude,lng:t.coords.longitude})},function(e){t(e)}):t(new Error("not supported geolocation."))})}},{key:"render",value:function(){var e=this,t=this.state,a=t.lat,n=t.lng;return a&&n?u.createElement(j,{query:k,variables:{lat:a,lng:n}},function(t){var a=t.data,n=t.fetchMore,o=t.loading;return e.fetchMore=n,u.createElement(w,Object.assign({},e.state,e.props,{loading:o,data:a,onChangeRegionComplete:e.onChangeRegionComplete}))}):null}}]),t}(u.Component),Object(i.a)(C.prototype,"onLoadMore",[h.a],Object.getOwnPropertyDescriptor(C.prototype,"onLoadMore"),C.prototype),Object(i.a)(C.prototype,"onChangeRegionComplete",[h.a],Object.getOwnPropertyDescriptor(C.prototype,"onChangeRegionComplete"),C.prototype),Object(i.a)(C.prototype,"getCurrentLocation",[h.a],Object.getOwnPropertyDescriptor(C.prototype,"getCurrentLocation"),C.prototype),C);t.default=P}}]);
//# sourceMappingURL=map.b909c387.chunk.js.map